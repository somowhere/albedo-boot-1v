
<template>
  <div class="app-container calendar-list-container">
    <div v-if="allConfiguration && configuration">
      <span>过滤 (按前缀)</span> <el-input v-model="filter" />
      <h2>Spring configuration</h2>
      <table class="el-table">
        <thead>
        <tr>
          <th class="w-40" @click="orderProp = 'prefix'; reverse=!reverse"><span>前缀</span></th>
          <th class="w-60" @click="orderProp = 'properties'; reverse=!reverse"><span>属性</span></th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="(entry, index) in configuration">
          <td><span>{{entry.prefix}}</span></td>
          <td>
            <div v-for="(item, key,index) in entry.properties">
              <el-row :span="24" :gutter="30">
                <el-col :span="8">{{key}}</el-col>
                <el-col :span="16">
                  <span class="float-right badge badge-secondary break">{{item | json }}</span>
                </el-col>
              </el-row>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
      <div v-for="(item, key,index) in allConfiguration" >
        <label><span>{{key}}</span></label>
        <table class="el-table">
          <thead>
          <tr>
            <th class="w-40">Property</th>
            <th class="w-60">Value</th>
          </tr>
          </thead>
          <tbody>
          <tr v-for="(temp, key, index) in item">
            <td class="break">{{key}}</td>
            <td class="break">
              <span class="float-right badge badge-secondary break">{{temp}}</span>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>

<script>
  import {configprops, getConfigprops, getEnv, getMetrics, threadDump} from "./service";
  import {validateNull} from "@/util/validate";

  export default {
    components: {
    },
    name: "admin_configuration",
    directives: {
    },
    data() {
      return{
        allConfiguration:{},
        configuration:{},
        configurationBak:{},
        configKeys:[],
        filter:undefined,
        orderProp:undefined,
        reverse: false
      };
    },
    computed: {
      // ...mapGetters(['authorities'])
    },
    filters: {
      json(value) {
        return JSON.stringify(value)
      },
    },
    watch:{
      filter(val) {
        var array = []
        for(const key in this.configurationBak){
          var item = this.configurationBak[key];
          if(item.prefix.indexOf(val) != -1){
            array.push(item);
          }
        };
        this.configuration = array;
      }
    },
    created() {
      this.initPageData();
    },
    methods: {
      initPageData() {
        getConfigprops().then(configuration => {
          this.configuration = configuration
          this.configurationBak = configuration
          console.log(configuration)
          for (const config in configuration) {
            if (config.properties !== undefined) {
              this.configKeys.push(Object.keys(config.properties));
            }
          }
        });
        getEnv().then(configuration=> {
          this.allConfiguration = configuration;
          console.log(configuration)
        });
      }

    }
  };
</script>
